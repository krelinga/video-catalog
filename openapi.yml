openapi: 3.0.3
info:
  title: Video Catalog Service
  description: API for managing video works and sources
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Development server

paths:
  /works/{uuid}:
    get:
      summary: Get a work by UUID
      description: Returns a Work object for the given UUID
      operationId: getWork
      parameters:
        - name: uuid
          in: path
          description: UUID of the work to retrieve
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Work'
        '404':
          description: Work not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '400':
          description: Invalid UUID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /works/{uuid}/movie:
    put:
      summary: Add a movie work with the given uuid.
      description: Adds a movie work identified by the given UUID
      operationId: putMovieWork
      parameters:
        - name: uuid
          in: path
          description: UUID of the work to add
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Movie'
      responses:
        '200':
          description: Movie work updated successfully
        '201':
          description: Movie added successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Work with this UUID already exists and is not a movie.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update a movie work with the given uuid.
      description: Updates a movie work identified by the given UUID
      operationId: patchMovieWork
      parameters:
        - name: uuid
          in: path
          description: UUID of the work to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Movie'
      responses:
        '200':
          description: Movie work updated successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Work with this UUID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Work with this UUID is not a movie.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /works/{uuid}/movie_edition:
    put:
      summary: Create (or replace) a movie edition work with the given uuid.
      description: Create (or replace) a movie edition with the given uuid.
      operationId: putMovieEdition
      parameters:
        - name: uuid
          in: path
          description: UUID of the work to which the movie edition will be added
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MovieEdition'
      responses:
        '200':
          description: Movie edition updated successfully
        '201':
          description: Movie edition added successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Work with this UUID already exists and is not a movie edition.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update a movie edition work with the given uuid.
      description: Updates a movie edition work identified by the given UUID
      operationId: patchMovieEdition
      parameters:
        - name: uuid
          in: path
          description: UUID of the work to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MovieEdition'
      responses:
        '200':
          description: Movie edition updated successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Work with this UUID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Work with this UUID is not a movie edition.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /sources/{uuid}:
    get:
      summary: Get a source by UUID
      description: Returns a Source object for the given UUID
      operationId: getSource
      parameters:
        - name: uuid
          in: path
          description: UUID of the source to retrieve
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Source'
        '404':
          description: Source not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '400':
          description: Invalid UUID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /sources/{uuid}/disc:
    put:
      summary: Add (or replace) a disc source with the given UUID.
      description: Adds (or replaces) a disc source identified by the given UUID
      operationId: putDiscSource
      parameters:
        - name: uuid
          in: path
          description: UUID of the disc source to add
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Disc'
      responses:
        '200':
          description: Disc source updated successfully
        '201':
          description: Disc source added successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Source with this UUID already exists and is not a disc.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update a disc source with the given uuid.
      description: Updates a disc source identified by the given UUID
      operationId: patchDiscSource
      parameters:
        - name: uuid
          in: path
          description: UUID of the disc source to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Disc'
      responses:
        '200':
          description: Disc source updated successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Source with this UUID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Source with this UUID is not a disc.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /sources/{uuid}/file:
    put:
      summary: Add (or replace) a file source with the given UUID.
      description: Adds (or replaces) a file source identified by the given UUID
      operationId: putFileSource
      parameters:
        - name: uuid
          in: path
          description: UUID of the file source to add
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/File'
      responses:
        '200':
          description: File source updated successfully
        '201':
          description: File source added successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Source with this UUID already exists and is not a file.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update a file source with the given uuid.
      description: Updates a file source identified by the given UUID
      operationId: patchFileSource
      parameters:
        - name: uuid
          in: path
          description: UUID of the file source to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/File'
      responses:
        '200':
          description: File source updated successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Source with this UUID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Source with this UUID is not a file.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /plans:
    get:
      summary: List plans with pagination
      description: Returns a paginated list of Plan objects
      operationId: listPlans
      parameters:
        - name: pageSize
          in: query
          description: Number of plans to return per page
          required: false
          schema:
            type: integer
            format: int32
        - name: pageToken
          in: query
          description: Token for fetching a specific page of results
          required: false
          schema:
            type: string
        - name: workUuid
          in: query
          description: Filter plans by associated work UUID
          required: false
          schema:
            type: string
            format: uuid
        - name: sourceUuid
          in: query
          description: Filter plans by associated source UUID
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlanPage'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /plans/{uuid}:
    get:
      summary: Get a plan by UUID
      description: Returns a Plan object for the given UUID
      operationId: getPlan
      parameters:
        - name: uuid
          in: path
          description: UUID of the plan to retrieve
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Plan'
        '404':
          description: Plan not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '400':
          description: Invalid UUID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /plans/{uuid}/direct:
    put:
      summary: Create (or update) a direct plan.
      description: Creates a new direct plan or updates an existing one identified by the given UUID.
      operationId: putDirectPlan
      parameters:
        - name: uuid
          in: path
          description: UUID of the plan to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                direct:
                  type: boolean
      responses:
        '200':
          description: Plan updated successfully
        '201':
          description: Plan created successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Plan with this UUID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Plan with this UUID already exists and is not a direct plan.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update a direct plan.
      description: Updates an existing direct plan identified by the given UUID.
      operationId: patchDirectPlan
      parameters:
        - name: uuid
          in: path
          description: UUID of the plan to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                direct:
                  type: boolean
      responses:
        '200':
          description: Plan updated successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Plan with this UUID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Plan with this UUID is not a direct plan.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /plans/{uuid}/chapter_range:
    put:
      summary: Create (or update) a chapter range plan.
      description: Creates a new chapter range plan or updates an existing one identified by the given UUID.
      operationId: putChapterRangePlan
      parameters:
        - name: uuid
          in: path
          description: UUID of the plan to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChapterRangePlan'
      responses:
        '200':
          description: Plan updated successfully
        '201':
          description: Plan created successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Plan with this UUID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Plan with this UUID already exists and is not a chapter range plan.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update a chapter range plan.
      description: Updates an existing chapter range plan identified by the given UUID.
      operationId: patchChapterRangePlan
      parameters:
        - name: uuid
          in: path
          description: UUID of the plan to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChapterRangePlan'
      responses:
        '200':
          description: Plan updated successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Plan with this UUID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Plan with this UUID is not a chapter range plan.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Work:
      type: object
      required:
        - uuid
      properties:
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the work
          example: "123e4567-e89b-12d3-a456-426614174000"
        movie:
          $ref: '#/components/schemas/Movie'
        movieEdition:
          $ref: '#/components/schemas/MovieEdition'

    Source:
      type: object
      required:
        - uuid
      properties:
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the source
          example: "223e4567-e89b-12d3-a456-426614174001"
        disc:
          $ref: '#/components/schemas/Disc'
        file:
          $ref: '#/components/schemas/File'

    Plan:
      type: object
      required:
        - uuid
      properties:
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the plan
          example: "523e4567-e89b-12d3-a456-426614174004"

        direct:
          $ref: '#/components/schemas/DirectPlan'
        chapterRange:
          $ref: '#/components/schemas/ChapterRangePlan'

    PlanPage:
      type: object
      properties:
        plans:
          type: array
          items:
            $ref: '#/components/schemas/Plan'
        nextPageToken:
          type: string
          description: Token for fetching the next page of results, if any
          example: "eyJwYWdlIjoyfQ=="

    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error message
          example: "Resource not found"
        code:
          type: string
          description: Error code
          example: "NOT_FOUND"

    Disc:
      type: object
      description: Details about a disc source.  Included if the source is a disc.
      properties:
        origDirName:
          type: string
          nullable: true
          description: Original directory name of the disc
          example: "MyDiscDirectory"
        path:
          type: string
          nullable: true
          description: Filesystem path where the disc is located
          example: "/nas/media/MyDiscDirectory"
        allFilesAdded:
          type: boolean
          nullable: true
          description: Indicates whether all files from the disc have been added
          example: true

    File: 
      type: object
      description: Details about a file source. Included if the source is a file.
      properties:
        path:
          type: string
          nullable: true
          description: Filesystem path of the file
          example: "/nas/media/MyDiscDirectory/movie.mkv"

    Movie:
      type: object
      description: Details specific to movie works.  Included if the work is a movie.
      properties:
        title:
          type: string
          nullable: true
          description: Title of the movie
          example: "Inception"
        releaseYear:
          type: integer
          nullable: true
          description: Release year of the movie
          example: 2010
        tmdbId:
          type: integer
          nullable: true
          description: The Movie Database (TMDb) identifier for the movie
          example: 27205

    MovieEdition:
      type: object
      description: Details about a specific edition of a movie.  Included if the work has a movie edition.
      properties:
        editionType:
          type: string
          nullable: true
          description: Type of the movie edition (e.g., "Director's Cut", "Theatrical")
          example: "Director's Cut"

    DirectPlan:
      type: object
      description: Represents a plan for producing a work directly from a source file without modification.
      properties:
        sourceUuid:
          type: string
          format: uuid
          nullable: true
          description: UUID of the source file
          example: "323e4567-e89b-12d3-a456-426614174002"
        workUuid:
          type: string
          format: uuid
          nullable: true
          description: UUID of the work to be produced.
          example: "123e4567-e89b-12d3-a456-426614174003"

    ChapterRangePlan:
      type: object
      description: Represents a plan for producing a work from specific chapters of a source file.
      properties:
        sourceUuid:
          type: string
          format: uuid
          nullable: true
          description: UUID of the source file containing the chapters
          example: "323e4567-e89b-12d3-a456-426614174002"
        workUuid:
          type: string
          format: uuid
          nullable: true
          description: UUID of the work that the chapters comprise.
          example: "123e4567-e89b-12d3-a456-426614174003"
        startChapter:
          type: integer
          format: int32
          nullable: true
          description: Starting chapter number (inclusive).  If null, starts from the beginning of the file.
          example: 1
        endChapter:
          type: integer
          format: int32
          nullable: true
          description: Ending chapter number (inclusive).  If null, ends at the end of the file.
          example: 5
